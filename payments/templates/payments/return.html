{% extends "payments/base.html" %}
{% block title %}نتيجة الدفع — Mujeb{% endblock %}
{% load humanize %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white rounded-2xl shadow p-8 text-center" dir="rtl">
  <h2 class="text-2xl font-bold mb-6">نتيجة الدفع</h2>

  {% if verify %}
    {% if verify.payment_result and verify.payment_result.response_status == "A" %}
      <div class="flex flex-col items-center mb-6">
        <div class="bg-green-100 text-green-700 p-4 rounded-full mb-3">✅</div>
        <h3 class="text-xl font-semibold text-green-700">تم الدفع بنجاح</h3>
        <p class="text-gray-600 mt-2">شكرًا لك! تم استلام دفعتك بنجاح.</p>
      </div>
    {% else %}
      <div class="flex flex-col items-center mb-6">
        <div class="bg-red-100 text-red-700 p-4 rounded-full mb-3">❌</div>
        <h3 class="text-xl font-semibold text-red-700">فشل الدفع</h3>
        <p class="text-gray-600 mt-2">للأسف لم تتم العملية. الرجاء التواصل مع الدعم.</p>
      </div>
      <div class="mt-4">
        <a href="https://wa.me/9647880007726?text=مرحبًا%20فشل%20الدفع%20لدي%20وأرغب%20بالمساعدة"
           class="inline-flex items-center gap-2 px-5 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-medium shadow">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12.04 2c-5.52 0-10 4.48-10 10 0 1.77.46 3.48 1.34 5l-1.42 5.19 5.33-1.4c1.43.77 3.02 1.17 4.67 1.17 5.52 0 10-4.48 10-10s-4.48-10-10-10zm0 18c-1.43 0-2.83-.38-4.05-1.1l-.29-.17-3.16.83.84-3.07-.19-.31c-.81-1.32-1.24-2.84-1.24-4.39 0-4.41 3.59-8 8-8s8 3.59 8 8-3.59 8-8 8zm4.2-5.9c-.23-.12-1.38-.68-1.59-.76-.21-.08-.36-.12-.5.12-.15.23-.57.76-.7.91-.13.15-.26.17-.49.06-.23-.12-.96-.35-1.84-1.11-.68-.6-1.14-1.34-1.27-1.57-.13-.23-.01-.35.1-.47.1-.1.23-.26.34-.38.11-.13.15-.23.23-.38.08-.15.04-.29-.02-.41-.06-.12-.5-1.19-.68-1.63-.18-.44-.36-.38-.5-.38-.13 0-.29-.02-.44-.02-.15 0-.41.06-.63.29-.21.23-.83.8-.83 1.95s.85 2.26.97 2.42c.12.15 1.68 2.57 4.07 3.6.57.25 1.01.4 1.35.51.57.18 1.09.15 1.5.09.46-.07 1.38-.56 1.57-1.1.19-.54.19-1 .13-1.1-.06-.1-.21-.15-.44-.27z"/>
          </svg>
          تواصل عبر واتساب
        </a>
      </div>
    {% endif %}
  {% else %}
    <div class="text-gray-600 mb-6">لم يتم العثور على نتيجة التحقق.</div>
  {% endif %}

  {% if verify and verify.payment_result and verify.payment_result.response_status == "A" %}
  <div class="bg-gray-50 rounded-lg p-4 text-right mb-6">
    <h4 class="font-medium text-gray-700 mb-3">تفاصيل العملية</h4>
    <table class="w-full text-sm text-gray-700">
      <tr class="border-b">
        <td class="py-2 font-semibold">رقم العملية:</td>
        <td class="py-2">{{ verify.tran_ref|default:"—" }}</td>
      </tr>
      <tr class="border-b">
        <td class="py-2 font-semibold">المبلغ:</td>
        <td class="py-2">{{ verify.cart_amount|floatformat:2|intcomma }} {{ verify.cart_currency|default:"" }}</td>
      </tr>
      <tr class="border-b">
        <td class="py-2 font-semibold">البريد الإلكتروني:</td>
        <td class="py-2">{{ verify.customer_details.email|default:"—" }}</td>
      </tr>
    </table>
  </div>
  {% endif %}

  <div class="flex justify-center gap-4">
    <a href="https://payment.mujeb.app?workspaceID={{ workspace_id }}&ownerEmail={{ owner_email }}" class="px-5 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg text-sm font-medium">
      الرجوع
    </a>
    {% if verify and verify.payment_result and verify.payment_result.response_status == "A" %}
    <a href="https://payment.mujeb.app?workspaceID={{ workspace_id }}&ownerEmail={{ owner_email }}" class="px-5 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium">
      متابعة
    </a>
    {% endif %}
  </div>
</div>
{% endblock %}
